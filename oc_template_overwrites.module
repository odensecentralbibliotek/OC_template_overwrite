<?php

function oc_template_overwrites_nemid_form_callback ($form, &$form_state) {
   $current_path = $_SESSION['current_path']  ;
   $response = array(
    '#type' => 'ajax',
    '#commands' => array(),
  );

  $form['nemid']['#markup'] = '<a href="/wayf/consume?destination=' . $current_path . '" >Login via NemID </a>'
      . '<div class="ding-wayf-create-user"><a class="create-user-link" href="/wayf/create-user/before-page">Opret bruger</a><br><br><a target="_blank" href="/side/opret-bruger-med-nemid">Se guide</a></div>';
  $response['#commands'][] = ajax_command_ding_popup('oc_template_overwrites', t('Login via NemID'), $form['nemid']['#markup'], array('refresh' => FALSE));

  return $response;
}
/*
 * Hooks into select modules template registry entries and swaps out with 
 * a position inside this module instead of their original module/templates.
 * allowing us to overwrite the backend functionality without including
 * templates in the admin theme.
 *  
 */
function oc_template_overwrites_theme_registry_alter(&$theme_registry)
{
    if(isset($theme_registry["opening_hours_admin"]))
    {
        $OC_template_repo = drupal_get_path('module','oc_template_overwrites') . "/templates";
        $theme_registry["opening_hours_admin"]["path"] = $OC_template_repo;
    }
    if(isset($theme_registry["file_entity"]))
    {
        $OC_template_repo = "file_entity";
        $ModuleTemplatePath = drupal_get_path('module','oc_template_overwrites') . "/templates";
        $theme_registry["file_entity"]["template"] = $OC_template_repo;
        $theme_registry["file_entity"]["path"] =  $ModuleTemplatePath;	
    }
}
/**
 * Implements hook_permission().
 */
function oc_template_overwrites_permission() {
  return array(
    'administer oc_template_overwrites' => array(
      'title' => t('Administrer oc_template_overwrites'),
      'description' => t('Giver adgang til configuere oc tempate overwrites'),

    )
  );
}
function  oc_template_overwrites_menu() {
  $items = array();
  $items['admin/settings/oc_template_overwrites'] = array(
    'title' => 'OC Overwrites',
    'description' => 'Configuration af oc digitalpost modul',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('oc_template_overwrites_admin'),
    'access arguments' => array('administer oc_template_overwrites'),
    'file' => 'oc_template_overwrites.admin.inc'
   );
  
  return $items;
}
/*
 * Hook places where we want to inject.
 */
function oc_template_overwrites_preprocess_html(&$page)
{
    //Add javascript if we are on frontpage.
    $Path = drupal_get_path('module', 'oc_template_overwrites') . '/js/ting_tablesorter_parsers.js';
    drupal_add_js($Path);
    if(drupal_is_front_page() && variable_get('Place2book_front_ticket_status', 0) == 1) //The setting has been enabled.
    {
        $Path = drupal_get_path('module', 'oc_template_overwrites') . "/js/p2b_frontpagestatus.js";
        drupal_add_js($Path);
    }
    $config = array(
            'nysfyn_link' => variable_get('nysfyn_home_page', ''),
            'is_active' => variable_get('nysfyn_badge_enabled', 0),
            'google_translate_enabled' => variable_get('google_translate_enabled', 0),
            'google_translate_languages' => variable_get('google_translate_languages', 'da,de,en,es,nl,no')
           );
          drupal_add_js(array('oc_template_overwrites' => $config), 'setting');
  
  if(drupal_is_front_page())
    {
    $meta_description = array(
    '#type' => 'html_tag',
    '#tag' => 'meta',
    '#attributes' => array(     
      'content' => variable_get('description_meta'),
      'name' =>  'description',
    )
  );
      drupal_add_html_head($meta_description, 'meta_description');  
    }        
 // Setup IE meta tag to force IE rendering mode
  $meta_ie_render_engine = array(
    '#type' => 'html_tag',
    '#tag' => 'meta',
    '#attributes' => array(
      'content' =>  'IE=Edge',
      'http-equiv' => 'X-UA-Compatible',
    )
  );
  // Add header meta tag for IE to head
  drupal_add_html_head($meta_ie_render_engine, 'meta_ie_render_engine');
}
